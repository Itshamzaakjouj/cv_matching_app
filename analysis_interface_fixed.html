<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TalentScope - Analyse des CVs</title>
    <link rel="icon" type="image/png" href="Logos/TalentScope.png">
    <link rel="stylesheet" href="themes.css">
    <link rel="stylesheet" href="professional-icons.css">
    <script src="direct-translation.js"></script>
    <script src="icon-replacer.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            border-radius: 0 20px 20px 0;
            padding: 30px 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            position: fixed;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .logo {
            text-align: center;
            margin-bottom: 40px;
        }

        .logo h1 {
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .logo p {
            color: #666;
            font-size: 0.9rem;
        }

        .nav-section {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .nav-title {
            font-size: 0.8rem;
            font-weight: 600;
            color: #999;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 20px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            margin-bottom: 8px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            color: #333;
        }

        .nav-item:hover {
            background: rgba(102, 126, 234, 0.1);
            transform: translateX(5px);
        }

        .nav-item.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .nav-item .nav-icon {
            margin-right: 12px;
            font-size: 1.2rem;
        }

        .nav-item .nav-text {
            flex: 1;
        }

        .nav-item .nav-title {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .nav-item .nav-subtitle {
            font-size: 0.8rem;
            opacity: 0.8;
        }

        /* User info */
        .user-info {
            margin-top: 20px;
            padding: 20px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 12px;
            border: 1px solid rgba(102, 126, 234, 0.2);
        }

        .user-profile-card {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .profile-photo {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .profile-info {
            flex: 1;
        }

        .profile-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 2px;
        }

        .profile-role {
            font-size: 0.8rem;
            color: #666;
        }

        .profile-actions {
            position: relative;
        }

        .profile-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: background 0.3s ease;
        }

        .profile-btn:hover {
            background: rgba(102, 126, 234, 0.1);
        }

        /* Main content */
        .main-content {
            flex: 1;
            margin-left: 280px;
            padding: 40px;
            overflow-y: auto;
        }

        .analysis-container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        /* Progress bar */
        .progress-container {
            margin-bottom: 40px;
        }

        .progress-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
            position: relative;
        }

        .step:not(:last-child)::after {
            content: '';
            position: absolute;
            top: 20px;
            left: 60%;
            width: 80%;
            height: 2px;
            background: #e0e0e0;
            z-index: 1;
        }

        .step.completed:not(:last-child)::after {
            background: #4CAF50;
        }

        .step-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.1rem;
            position: relative;
            z-index: 2;
            background: #e0e0e0;
            color: #999;
        }

        .step.active .step-circle {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .step.completed .step-circle {
            background: #4CAF50;
            color: white;
        }

        .step.completed .step-circle::before {
            content: '✓';
        }

        .step-label {
            margin-top: 10px;
            font-size: 0.9rem;
            font-weight: 600;
            color: #666;
            text-align: center;
        }

        .step.active .step-label {
            color: #667eea;
        }

        .step.completed .step-label {
            color: #4CAF50;
        }

        /* Form sections */
        .form-section {
            display: none;
        }

        .form-section.active {
            display: block;
        }

        .section-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-description {
            color: #666;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .form-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }

        .form-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #f5f5f5;
            color: #666;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* File upload area */
        .file-upload-area {
            border: 2px dashed #e0e0e0;
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .file-upload-area:hover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }

        .file-upload-area.dragover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }

        .upload-icon {
            font-size: 3rem;
            color: #ccc;
            margin-bottom: 20px;
        }

        .upload-text {
            font-size: 1.1rem;
            color: #666;
            margin-bottom: 10px;
        }

        .upload-hint {
            font-size: 0.9rem;
            color: #999;
        }

        /* Results section */
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .result-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            border-left: 4px solid #667eea;
        }

        .result-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }

        .result-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #667eea;
        }

        .status-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-excellent {
            background: #d4edda;
            color: #155724;
        }

        .status-good {
            background: #d1ecf1;
            color: #0c5460;
        }

        .status-average {
            background: #fff3cd;
            color: #856404;
        }

        .status-poor {
            background: #f8d7da;
            color: #721c24;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
                padding: 20px;
            }

            .analysis-container {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="logo">
            <div style="display: flex; align-items: center; justify-content: center; gap: 15px; margin-bottom: 20px;">
                <img src="Logos/TalentScope.png" alt="TalentScope" style="height: 40px;">
                <img src="Logos/MEF2.png" alt="MEF" style="height: 40px;">
            </div>
            <h1>TalentScope</h1>
            <p>Ministère de l'Économie et des Finances</p>
        </div>

        <div class="nav-section">
            <div class="nav-title">NAVIGATION</div>
            
            <a href="/dashboard" class="nav-item">
                <span class="nav-icon">🏠</span>
                <div class="nav-text">
                    <div class="nav-title">Accueil</div>
                    <div class="nav-subtitle">Page principale</div>
                </div>
            </a>

            <a href="/dashboard" class="nav-item">
                <span class="nav-icon">📊</span>
                <div class="nav-text">
                    <div class="nav-title">Tableau de Bord</div>
                    <div class="nav-subtitle">Vue d'ensemble</div>
                </div>
            </a>

            <a href="/analysis" class="nav-item active">
                <span class="nav-icon">🚀</span>
                <div class="nav-text">
                    <div class="nav-title">Nouvelle Analyse</div>
                    <div class="nav-subtitle">Analyser des CVs</div>
                </div>
            </a>

            <a href="/dashboard" class="nav-item">
                <span class="nav-icon">📁</span>
                <div class="nav-text">
                    <div class="nav-title">CVs Traités</div>
                    <div class="nav-subtitle">Historique des analyses</div>
                </div>
            </a>

            <a href="/dashboard" class="nav-item">
                <span class="nav-icon">⚙️</span>
                <div class="nav-text">
                    <div class="nav-title">Configuration</div>
                    <div class="nav-subtitle">Paramètres</div>
                </div>
            </a>
        </div>

        <div class="user-info">
            <div class="user-profile-card">
                <div class="profile-photo">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                    </svg>
                </div>
                <div class="profile-info">
                    <div class="profile-name" id="user-fullname">Utilisateur</div>
                    <div class="profile-role">Ministère des Finances</div>
                </div>
                <div class="profile-actions">
                    <button class="profile-btn" onclick="editProfile()" title="Gestion du profil">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <div class="analysis-container">
            <!-- Progress Bar -->
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="step active" data-step="1">
                        <div class="step-circle">1</div>
                        <div class="step-label">Offre d'emploi</div>
                    </div>
                    <div class="step" data-step="2">
                        <div class="step-circle">2</div>
                        <div class="step-label">Importation CVs</div>
                    </div>
                    <div class="step" data-step="3">
                        <div class="step-circle">3</div>
                        <div class="step-label">Vérification</div>
                    </div>
                    <div class="step" data-step="4">
                        <div class="step-circle">4</div>
                        <div class="step-label">Résultats</div>
                    </div>
                </div>
            </div>

            <!-- Step 1: Job Description -->
            <div class="form-section active" id="step1">
                <h2 class="section-title">
                    <span>📄</span>
                    Saisie de l'offre d'emploi
                </h2>
                <p class="section-description">
                    Décrivez le poste à pourvoir en détail. Plus votre description est précise, plus l'analyse sera pertinente.
                </p>

                <form id="jobForm" onsubmit="handleJobFormSubmit(event)">
                    <div class="form-group">
                        <label class="form-label" for="jobTitle">Titre du poste *</label>
                        <input type="text" id="jobTitle" class="form-input" placeholder="Ex: Data Scientist Senior" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="jobDescription">Description du poste *</label>
                        <textarea id="jobDescription" class="form-input form-textarea" placeholder="Décrivez les missions, responsabilités, compétences requises, expérience souhaitée..." required></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="keySkills">Compétences clés</label>
                        <input type="text" id="keySkills" class="form-input" placeholder="Ex: Python, Machine Learning, SQL, TensorFlow (séparées par des virgules)">
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="goToDashboard()">Annuler</button>
                        <button type="submit" class="btn btn-primary">Suivant</button>
                    </div>
                </form>
            </div>

            <!-- Step 2: CV Upload -->
            <div class="form-section" id="step2">
                <h2 class="section-title">
                    <span>📤</span>
                    Importation des CVs
                </h2>
                <p class="section-description">
                    Téléchargez les CVs à analyser. Vous pouvez glisser-déposer plusieurs fichiers ou cliquer pour sélectionner.
                </p>

                <div class="file-upload-area" id="fileUploadArea">
                    <div class="upload-icon">📄</div>
                    <div class="upload-text">Glissez-déposez vos CVs ici</div>
                    <div class="upload-hint">ou cliquez pour sélectionner des fichiers</div>
                    <input type="file" id="fileInput" multiple accept=".pdf,.doc,.docx" style="display: none;">
                </div>

                <div id="fileList" style="margin-top: 20px;"></div>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="previousStep()">Précédent</button>
                    <button type="button" class="btn btn-primary" onclick="nextStep()" id="nextStep2" disabled>Suivant</button>
                </div>
            </div>

            <!-- Step 3: Verification -->
            <div class="form-section" id="step3">
                <h2 class="section-title">
                    <span>✅</span>
                    Vérification des données
                </h2>
                <p class="section-description">
                    Vérifiez les informations saisies avant de lancer l'analyse.
                </p>

                <div id="verificationContent">
                    <!-- Contenu généré dynamiquement -->
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="previousStep()">Précédent</button>
                    <button type="button" class="btn btn-primary" onclick="startAnalysis()">Lancer l'analyse</button>
                </div>
            </div>

            <!-- Step 4: Results -->
            <div class="form-section" id="step4">
                <h2 class="section-title">
                    <span>📊</span>
                    Résultats de l'analyse
                </h2>
                <p class="section-description">
                    Voici les résultats de l'analyse de vos CVs.
                </p>

                <div id="resultsContent">
                    <!-- Contenu généré dynamiquement -->
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="goToDashboard()">Retour au tableau de bord</button>
                    <button type="button" class="btn btn-primary" onclick="newAnalysis()">Nouvelle analyse</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentStep = 1;
        let jobData = {};
        let uploadedFiles = [];

        // Initialize user profile
        function initializeUserProfile() {
            const savedName = localStorage.getItem('userFullName');
            if (savedName) {
                document.getElementById('user-fullname').textContent = savedName;
            } else {
                localStorage.setItem('userFullName', 'Utilisateur');
            }
        }

        // Profile management
        function editProfile() {
            window.location.href = '/profile';
        }

        // Navigation functions
        function goToDashboard() {
            window.location.href = '/dashboard';
        }

        function newAnalysis() {
            currentStep = 1;
            jobData = {};
            uploadedFiles = [];
            resetSteps();
            showStep(1);
        }

        // Step management
        function resetSteps() {
            document.querySelectorAll('.step').forEach(step => {
                step.classList.remove('active', 'completed');
            });
            document.querySelectorAll('.form-section').forEach(section => {
                section.classList.remove('active');
            });
        }

        function showStep(stepNumber) {
            resetSteps();
            
            // Activer l'étape courante
            document.querySelector(`[data-step="${stepNumber}"]`).classList.add('active');
            document.getElementById(`step${stepNumber}`).classList.add('active');
            
            // Marquer les étapes précédentes comme complétées
            for (let i = 1; i < stepNumber; i++) {
                document.querySelector(`[data-step="${i}"]`).classList.add('completed');
            }
            
            // Réinitialiser l'upload si on arrive à l'étape 2
            if (stepNumber === 2) {
                setTimeout(() => {
                    initializeFileUpload();
                }, 100);
            }
        }

        function nextStep() {
            if (currentStep < 4) {
                currentStep++;
                showStep(currentStep);
                
                if (currentStep === 3) {
                    generateVerificationContent();
                }
            }
        }

        function previousStep() {
            if (currentStep > 1) {
                currentStep--;
                showStep(currentStep);
            }
        }

        // Form handling
        function handleJobFormSubmit(e) {
            e.preventDefault();
            
            // Validation des champs requis
            const title = document.getElementById('jobTitle').value.trim();
            const description = document.getElementById('jobDescription').value.trim();
            
            if (!title || !description) {
                alert('Veuillez remplir au moins le titre et la description du poste.');
                return;
            }
            
            jobData = {
                title: title,
                description: description,
                skills: document.getElementById('keySkills').value.trim()
            };
            
            console.log('Données du job sauvegardées:', jobData);
            nextStep();
        }

        // File upload handling
        function initializeFileUpload() {
            const fileUploadArea = document.getElementById('fileUploadArea');
            const fileInput = document.getElementById('fileInput');

            if (!fileUploadArea || !fileInput) {
                console.error('Éléments d\'upload non trouvés');
                return;
            }

            // Supprimer les anciens événements
            fileUploadArea.removeEventListener('click', handleUploadClick);
            fileUploadArea.removeEventListener('dragover', handleDragOver);
            fileUploadArea.removeEventListener('drop', handleDrop);
            fileUploadArea.removeEventListener('dragleave', handleDragLeave);
            fileInput.removeEventListener('change', handleFileSelect);

            // Ajouter les nouveaux événements
            fileUploadArea.addEventListener('click', handleUploadClick);
            fileUploadArea.addEventListener('dragover', handleDragOver);
            fileUploadArea.addEventListener('drop', handleDrop);
            fileUploadArea.addEventListener('dragleave', handleDragLeave);
            fileInput.addEventListener('change', handleFileSelect);

            console.log('Upload de fichiers initialisé');
        }

        function handleUploadClick() {
            const fileInput = document.getElementById('fileInput');
            if (fileInput) {
                fileInput.click();
            }
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.stopPropagation();
            const fileUploadArea = document.getElementById('fileUploadArea');
            if (fileUploadArea) {
                fileUploadArea.classList.add('dragover');
            }
        }

        function handleDragLeave(e) {
            e.preventDefault();
            e.stopPropagation();
            const fileUploadArea = document.getElementById('fileUploadArea');
            if (fileUploadArea) {
                fileUploadArea.classList.remove('dragover');
            }
        }

        function handleDrop(e) {
            e.preventDefault();
            e.stopPropagation();
            const fileUploadArea = document.getElementById('fileUploadArea');
            if (fileUploadArea) {
                fileUploadArea.classList.remove('dragover');
            }
            
            const files = Array.from(e.dataTransfer.files);
            console.log('Fichiers déposés:', files.length);
            processFiles(files);
        }

        function handleFileSelect(e) {
            const files = Array.from(e.target.files);
            console.log('Fichiers sélectionnés:', files.length);
            processFiles(files);
        }

        function processFiles(files) {
            const allowedTypes = ['.pdf', '.doc', '.docx'];
            const validFiles = [];
            
            files.forEach(file => {
                const fileExtension = '.' + file.name.split('.').pop().toLowerCase();
                if (allowedTypes.includes(fileExtension)) {
                    validFiles.push(file);
                } else {
                    alert(`Le fichier "${file.name}" n'est pas supporté. Formats acceptés: PDF, DOC, DOCX`);
                }
            });
            
            if (validFiles.length > 0) {
                uploadedFiles = [...uploadedFiles, ...validFiles];
                displayFileList();
                updateNextButton();
                console.log('Fichiers ajoutés:', validFiles.length);
            }
        }

        function displayFileList() {
            const fileList = document.getElementById('fileList');
            fileList.innerHTML = '';
            
            uploadedFiles.forEach((file, index) => {
                const fileItem = document.createElement('div');
                fileItem.style.cssText = 'display: flex; align-items: center; justify-content: space-between; padding: 10px; background: #f8f9fa; border-radius: 8px; margin-bottom: 10px;';
                fileItem.innerHTML = `
                    <span>📄 ${file.name}</span>
                    <button onclick="removeFile(${index})" style="background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">Supprimer</button>
                `;
                fileList.appendChild(fileItem);
            });
        }

        function removeFile(index) {
            uploadedFiles.splice(index, 1);
            displayFileList();
            updateNextButton();
        }

        function updateNextButton() {
            const nextButton = document.getElementById('nextStep2');
            nextButton.disabled = uploadedFiles.length === 0;
        }

        // Verification content
        function generateVerificationContent() {
            const content = document.getElementById('verificationContent');
            content.innerHTML = `
                <div style="background: #f8f9fa; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <h3 style="margin-bottom: 15px; color: #333;">📄 Offre d'emploi</h3>
                    <p><strong>Titre:</strong> ${jobData.title}</p>
                    <p><strong>Description:</strong> ${jobData.description}</p>
                    <p><strong>Compétences:</strong> ${jobData.skills || 'Non spécifiées'}</p>
                </div>
                <div style="background: #f8f9fa; padding: 20px; border-radius: 12px;">
                    <h3 style="margin-bottom: 15px; color: #333;">📁 CVs à analyser (${uploadedFiles.length})</h3>
                    ${uploadedFiles.map(file => `<p>📄 ${file.name}</p>`).join('')}
                </div>
            `;
        }

        // Analysis functions
        function startAnalysis() {
            // Simuler l'analyse
            showStep(4);
            generateResults();
        }

        function generateResults() {
            const content = document.getElementById('resultsContent');
            
            // Générer des résultats simulés
            const results = generateMockResults();
            
            content.innerHTML = `
                <div class="results-grid">
                    <div class="result-card">
                        <div class="result-title">CVs Analysés</div>
                        <div class="result-value">${results.totalCvs}</div>
                    </div>
                    <div class="result-card">
                        <div class="result-title">Score Moyen</div>
                        <div class="result-value">${results.averageScore}%</div>
                    </div>
                    <div class="result-card">
                        <div class="result-title">Meilleur Match</div>
                        <div class="result-value">${results.bestMatch}%</div>
                    </div>
                </div>
                
                <div style="margin-top: 30px;">
                    <h3 style="margin-bottom: 20px; color: #333;">Détails par CV</h3>
                    ${results.cvDetails.map(cv => `
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center;">
                            <span>📄 ${cv.name}</span>
                            <span class="status-badge status-${cv.status}">${cv.score}% - ${cv.statusText}</span>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function generateMockResults() {
            return {
                totalCvs: uploadedFiles.length,
                averageScore: Math.floor(Math.random() * 40) + 60,
                bestMatch: Math.floor(Math.random() * 20) + 80,
                cvDetails: uploadedFiles.map(file => {
                    const score = Math.floor(Math.random() * 100);
                    let status, statusText;
                    if (score >= 80) { status = 'excellent'; statusText = 'Excellent'; }
                    else if (score >= 60) { status = 'good'; statusText = 'Bon'; }
                    else if (score >= 40) { status = 'average'; statusText = 'Moyen'; }
                    else { status = 'poor'; statusText = 'Faible'; }
                    
                    return {
                        name: file.name,
                        score: score,
                        status: status,
                        statusText: statusText
                    };
                })
            };
        }

        // Initialize app
        function initializeAnalysisApp() {
            initializeUserProfile();
            
            // Attendre que le gestionnaire de traduction soit chargé
            setTimeout(() => {
                if (window.directTranslationManager) {
                    const savedLanguage = localStorage.getItem('language') || 'fr';
                    window.directTranslationManager.applyLanguage(savedLanguage);
                }
            }, 100);
            
            // S'assurer que le formulaire est correctement attaché
            setTimeout(() => {
                const jobForm = document.getElementById('jobForm');
                if (jobForm) {
                    console.log('Formulaire trouvé et attaché');
                } else {
                    console.error('Formulaire non trouvé');
                }
            }, 200);
            
            // Initialiser l'upload de fichiers
            setTimeout(() => {
                initializeFileUpload();
            }, 300);
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM chargé, initialisation de l\'app...');
            initializeAnalysisApp();
        });
    </script>
</body>
</html>
