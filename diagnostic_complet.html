<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagnostic Complet - TalentScope</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 20px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .section {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
            border-left: 4px solid #007bff;
        }
        .error {
            border-left-color: #dc3545;
            background: #f8d7da;
        }
        .success {
            border-left-color: #28a745;
            background: #d4edda;
        }
        .warning {
            border-left-color: #ffc107;
            background: #fff3cd;
        }
        .data-item {
            margin: 10px 0;
            padding: 8px;
            background: white;
            border-radius: 3px;
            font-family: monospace;
        }
        .label {
            font-weight: bold;
            color: #333;
        }
        .value {
            color: #666;
            margin-left: 10px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .danger-btn {
            background: #dc3545;
        }
        .danger-btn:hover {
            background: #c82333;
        }
        .success-btn {
            background: #28a745;
        }
        .success-btn:hover {
            background: #218838;
        }
        .log {
            background: #000;
            color: #0f0;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Diagnostic Complet - TalentScope</h1>
        <p>Cette page vous aide √† diagnostiquer et r√©soudre les probl√®mes de donn√©es utilisateur.</p>
    </div>

    <div class="container">
        <h2>üìä √âtat actuel des donn√©es</h2>
        <div id="dataStatus" class="section">
            <p>Chargement...</p>
        </div>
    </div>

    <div class="container">
        <h2>üõ†Ô∏è Actions de diagnostic</h2>
        <div class="section">
            <button onclick="runFullDiagnostic()">üîç Diagnostic complet</button>
            <button onclick="createTestUser()" class="success-btn">üë§ Cr√©er utilisateur test</button>
            <button onclick="testProfilePage()">üë§ Tester page profil</button>
            <button onclick="simulateLogin()" class="success-btn">üîê Simuler connexion</button>
            <button onclick="clearAllData()" class="danger-btn">üóëÔ∏è Effacer tout</button>
        </div>
    </div>

    <div class="container">
        <h2>üìù Logs de d√©bogage</h2>
        <div class="section">
            <button onclick="clearLogs()">üßπ Effacer logs</button>
            <div id="debugLogs" class="log">Logs de d√©bogage appara√Ætront ici...\n</div>
        </div>
    </div>

    <div class="container">
        <h2>üìã Instructions de r√©solution</h2>
        <div class="section">
            <h3>Si les donn√©es ne s'affichent pas :</h3>
            <ol>
                <li>Cliquez sur "Diagnostic complet" pour identifier le probl√®me</li>
                <li>Si aucune donn√©e n'existe, cliquez sur "Cr√©er utilisateur test"</li>
                <li>Si les donn√©es existent mais ne s'affichent pas, cliquez sur "Tester page profil"</li>
                <li>V√©rifiez les logs de d√©bogage pour plus de d√©tails</li>
            </ol>
            
            <h3>Si vous avez d√©j√† un compte :</h3>
            <ol>
                <li>Cliquez sur "Simuler connexion" pour recr√©er vos donn√©es</li>
                <li>Ou utilisez "Cr√©er utilisateur test" avec vos vraies informations</li>
            </ol>
        </div>
    </div>

    <script>
        let debugLogs = [];
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            const logMessage = `[${timestamp}] ${message}`;
            debugLogs.push(logMessage);
            updateLogDisplay();
            console.log(logMessage);
        }
        
        function updateLogDisplay() {
            const logElement = document.getElementById('debugLogs');
            logElement.textContent = debugLogs.join('\n');
            logElement.scrollTop = logElement.scrollHeight;
        }
        
        function clearLogs() {
            debugLogs = [];
            updateLogDisplay();
        }
        
        function checkDataStatus() {
            log('V√©rification de l\'√©tat des donn√©es...');
            
            const userData = localStorage.getItem('userData');
            const userFullName = localStorage.getItem('userFullName');
            const isAuthenticated = localStorage.getItem('isAuthenticated');
            
            const statusDiv = document.getElementById('dataStatus');
            let html = '';
            
            // V√©rifier l'authentification
            if (isAuthenticated === 'true') {
                html += '<div class="data-item success"><span class="label">‚úÖ Authentifi√©:</span><span class="value">Oui</span></div>';
                log('Utilisateur authentifi√©');
            } else {
                html += '<div class="data-item error"><span class="label">‚ùå Authentifi√©:</span><span class="value">Non</span></div>';
                log('Utilisateur non authentifi√©');
            }
            
            // V√©rifier le nom complet (legacy)
            if (userFullName) {
                html += '<div class="data-item success"><span class="label">‚úÖ Nom complet (legacy):</span><span class="value">' + userFullName + '</span></div>';
                log('Nom complet trouv√©: ' + userFullName);
            } else {
                html += '<div class="data-item warning"><span class="label">‚ö†Ô∏è Nom complet (legacy):</span><span class="value">Non d√©fini</span></div>';
                log('Nom complet (legacy) non trouv√©');
            }
            
            // V√©rifier les donn√©es utilisateur compl√®tes
            if (userData) {
                try {
                    const user = JSON.parse(userData);
                    log('Donn√©es utilisateur trouv√©es et pars√©es avec succ√®s');
                    
                    html += '<div class="data-item success"><span class="label">‚úÖ Donn√©es utilisateur:</span><span class="value">Trouv√©es</span></div>';
                    html += '<div class="data-item"><span class="label">üìß Email:</span><span class="value">' + (user.email || 'Non d√©fini') + '</span></div>';
                    html += '<div class="data-item"><span class="label">üë§ Nom complet:</span><span class="value">' + (user.fullName || 'Non d√©fini') + '</span></div>';
                    html += '<div class="data-item"><span class="label">üè¢ D√©partement:</span><span class="value">' + (user.department || 'Non d√©fini') + '</span></div>';
                    html += '<div class="data-item"><span class="label">üíº Poste:</span><span class="value">' + (user.position || 'Non d√©fini') + '</span></div>';
                    html += '<div class="data-item"><span class="label">üìû T√©l√©phone:</span><span class="value">' + (user.phone || 'Non d√©fini') + '</span></div>';
                    
                    // V√©rifier si les donn√©es sont compl√®tes
                    const missingFields = [];
                    if (!user.email) missingFields.push('email');
                    if (!user.fullName) missingFields.push('fullName');
                    if (!user.department) missingFields.push('department');
                    if (!user.position) missingFields.push('position');
                    
                    if (missingFields.length === 0) {
                        html += '<div class="data-item success"><span class="label">‚úÖ Compl√©tude:</span><span class="value">Donn√©es compl√®tes</span></div>';
                        log('Toutes les donn√©es utilisateur sont pr√©sentes');
                    } else {
                        html += '<div class="data-item warning"><span class="label">‚ö†Ô∏è Compl√©tude:</span><span class="value">Champs manquants: ' + missingFields.join(', ') + '</span></div>';
                        log('Champs manquants: ' + missingFields.join(', '));
                    }
                    
                } catch (e) {
                    html += '<div class="data-item error"><span class="label">‚ùå Donn√©es utilisateur:</span><span class="value">Corrompues</span></div>';
                    log('Erreur de parsing des donn√©es utilisateur: ' + e.message);
                }
            } else {
                html += '<div class="data-item error"><span class="label">‚ùå Donn√©es utilisateur:</span><span class="value">Non trouv√©es</span></div>';
                log('Aucune donn√©e utilisateur trouv√©e');
            }
            
            statusDiv.innerHTML = html;
        }
        
        function runFullDiagnostic() {
            log('=== D√âBUT DU DIAGNOSTIC COMPLET ===');
            checkDataStatus();
            
            // Test de la page de profil
            log('Test de la page de profil...');
            setTimeout(() => {
                const profileWindow = window.open('/profile', '_blank');
                if (profileWindow) {
                    log('Page de profil ouverte dans un nouvel onglet');
                } else {
                    log('Erreur: Impossible d\'ouvrir la page de profil');
                }
            }, 1000);
            
            log('=== FIN DU DIAGNOSTIC COMPLET ===');
        }
        
        function createTestUser() {
            log('Cr√©ation d\'un utilisateur de test...');
            
            const testUserData = {
                email: "hafsa.elghazouani@example.com",
                fullName: "Hafsa El Ghazouani",
                department: "Minist√®re des Finances",
                position: "Analyste RH",
                phone: "+212 6 12 34 56 78",
                loginTime: new Date().toISOString(),
                sessionId: 'session_' + Date.now()
            };
            
            localStorage.setItem('userData', JSON.stringify(testUserData));
            localStorage.setItem('userFullName', testUserData.fullName);
            localStorage.setItem('isAuthenticated', 'true');
            
            log('Utilisateur de test cr√©√©: ' + testUserData.fullName);
            log('Email: ' + testUserData.email);
            
            alert('‚úÖ Utilisateur de test cr√©√© avec succ√®s !\n\nNom: ' + testUserData.fullName + '\nEmail: ' + testUserData.email);
            checkDataStatus();
        }
        
        function testProfilePage() {
            log('Ouverture de la page de profil pour test...');
            const profileWindow = window.open('/profile', '_blank');
            if (profileWindow) {
                log('Page de profil ouverte - v√©rifiez la console pour les logs de d√©bogage');
            } else {
                log('Erreur: Impossible d\'ouvrir la page de profil');
            }
        }
        
        function simulateLogin() {
            log('Simulation d\'une connexion...');
            
            const userData = {
                email: prompt('Entrez votre email:', 'hafsa.elghazouani@example.com'),
                fullName: prompt('Entrez votre nom complet:', 'Hafsa El Ghazouani'),
                department: prompt('Entrez votre d√©partement:', 'Minist√®re des Finances'),
                position: prompt('Entrez votre poste:', 'Analyste RH'),
                phone: prompt('Entrez votre t√©l√©phone:', '+212 6 12 34 56 78'),
                loginTime: new Date().toISOString(),
                sessionId: 'session_' + Date.now()
            };
            
            localStorage.setItem('userData', JSON.stringify(userData));
            localStorage.setItem('userFullName', userData.fullName);
            localStorage.setItem('isAuthenticated', 'true');
            
            log('Connexion simul√©e pour: ' + userData.fullName);
            checkDataStatus();
        }
        
        function clearAllData() {
            if (confirm('√ätes-vous s√ªr de vouloir effacer toutes les donn√©es utilisateur ?')) {
                log('Effacement de toutes les donn√©es...');
                localStorage.removeItem('userData');
                localStorage.removeItem('userFullName');
                localStorage.removeItem('isAuthenticated');
                log('Toutes les donn√©es ont √©t√© effac√©es');
                checkDataStatus();
            }
        }
        
        // Initialisation
        window.onload = function() {
            log('Page de diagnostic charg√©e');
            checkDataStatus();
        };
    </script>
</body>
</html>

